[도커]

###   도커를 쓰는 이유  
어떠한 프로그램을 다운로드 하는 과정을 간단하기 만들기 위해서 입니다. 

###  도커란      
  컨테이너를 사용하여 응용프로그램을 더 쉽게 만들고 배포하고 실행할 수 있더록 설계된 도구     
  즉, 컨테이너 기반의 오픈소스 가상화 플랫홈 / 생태계   

###  컨테이너 VS 컨테이너 이미지    
   - 컨테이너 : 코드와 모든 종속성을 패키지화해서 응용 프로그램이 한 컴퓨팅 환경에서 다른 컴퓨팅 환경으로 빠르고 안정적으로 실행 되도록 하는 소프트웨어의 표준단위   
              즉, 간단하고 편리하게 프로그램을 실행시켜주는 것   
              이미지의 인스턴스이며 프로그램을 실행시킨다   
              컨테이너는 소프트환경으로부터 격리시키고 개발과 스테이징의 차이에도 불구하고 균일하게 작동하도록 보장한다.   
   - 컨테이너 이미지 : 코드, 런타임, 시스템 도구, 시스템 라이브러리 및 설정과 같은 응요 프로그램을 실행하는데 필요한 모든것을 포함하는 가볍고 독립적이며 실행 가능 한 소프트웨어 패키지   
                   즉, 프로그램을 실행하는데 필요한 설정이나 종속성을 갖고있다   
   즉, 도커 이미지는 프로그램을 실행하는데 필요한 설정이나 종속성을 갖고 있으며 도커 이미지를 이용해서 컨테이너를 생성하며 도커 컨테이너를 이용하여 프로그램을 실행한다.    

###  C Group VS 네임스페이스      
  둘다 컨테이너와 호스트에서 실해오디는 다른 프로세스 사이에 벽을 만드는 리눅스 커널 기능들이다.    
  C Group : CPU, 메모리 등 프로세스 그룹의 시스템 리소스 사용량을 관리   
            즉, 어떤 어플이 사용량이 너무 많으면 그 어플리케이션 같은 것들을 G Group에 집어 넣어 CPU와 메모리 사용제한 가능   
  네임스페이스 : 별개의 독립된 공간을 사용하는 것처럼 격리된 환경을 만들어주는 경량 가상화 기술   
     
### 파일 스냅숏.    
   디렉터리나 파일을 카피한 것    
      
###  생명주기        
  생성 -> 시작 -> 실행 -> 중지 -> 삭제   
  - docker create : 생성 ~   
  - docker start : 시작~   
  - docker run : 생성 ~ 실행   
  - docker stop : 실행 ~ 중지   
  - docker rm : 중지 ~ 삭제   
    
###  명령어      
   $ docker ps      
     현재 실행중인 컨테이너 나열   
   항목 :   
   container id : 고유한 아이디 해쉬값. 실제로는 더 길지만 일부분만 표출   
   image: 컨테이너 생성 시 사용한 도커 이미지   
   command : 컨테이너 시작 시 실행 될 명령어. 대부분 이미지에 내장되어 있으므로 별도 설정이 필요X   
   created : 컨테이너가 생성된 시간   
   status : 컨테이서 상태. UP (실행중), Exited (종료), Pause (일시정지)   
   ports : 컨테이너가 개방한 포트와 호스트에 연결한 포트   
      
$ docker ps —format ‘table{{.Names}}\table{{.Image}}’         
  원하는 항목만 볼수있다. 위의 경우 Names와 Image 항목만 표출   
     
$ docker ps -a      
  전체항목 표출   
  
###  중지 stop VS kill     
  중지 시, 두가지로 중지 시킬수 있다.       
  $ docker stop      
    stop은 Gracefully 하게 중지를 시킨다. gracefully란 진행중인 작업(메시지를 보내고 있었다면 보내고 있던 메시지)을 완료하고 컨테이너를 중시시킨다. (중지시 몇초의 시간 소요)      
    docker stop -> SIGTERM -> Grace Period(정리하는 시간) -> SIGKILL -> 컨테이너(메인 프로세스)   
       
  $ docker kill       
    kill은 어떤것도 기다리지 않고 마로 컨테이너를 중지시킴   
    docker kill ->  SIGKILL (정리하는시간 없음) -> 컨테이너(메인 프로세스)   
       
### 삭제 rm      
  $ docker rm <아이디/이름>       
  실행중인 컨테이너는 중지 후 삭제가능        
  
$ docker rm ‘docker ps -a -q’        
  모든 컨테이너 삭제      
     
$ docker rmi <이미지id>      
  이미지 삭제    
     
$ docker system prune      
  사용하지 않은(실행중인거 빼고) 컨테이너, 이미지, 네트워크를 모두 삭제   
  도커를 계속 사용하다보면 은근 메모리가 쌓여 도커를 쓰지 않을때 사용해주면 좋음   
     
### 실행중인 컨테이너에 명령어 실행       
  $ docker exec <컨테이너아이디>   
  (터미널 2개로 실행)   
     
$ docker exec -it <컨테이너아이디> <명령어>      
  -it 를 붙여줘야 명령어를 실행한후 계속 명령어를 적을수 있다. -it 가 없다면 그냥 켜기만 하고(ex>redis-cli) 밖으로 나와버린다. 그래서 이후 명령어로 실행을할수없음(ex>redis실행들을)   
     
$ docker exec -it <컨테이너아이디> sh       
  => 그런데! 이런식으로 명령어 하나 실행마다 일일히 -it 붙여서 해줄수 없기 때문에 
  이 문제를 해결하기 위해 컨테이너 안에 쉘이나 터미널 환경으로 접속을 해줄 수 있다.   
  마지막 명령어를 sh로 주면 된다.     
     
  docker run -if <컨테이너아이디> sh  도 가능.   
  영령어 치면 /# 으로 shell 입력 형태가 되고, 빠져 나오려면 control + D    
  여기서 아래같은 리눅스명령어를 실행할수 있다   
  ls : 컨테이너 디렉토리에 있는 내용(디렉토리, 파일) 확인   
  touch new-file : 파일 생성   
  export hello=hi    
  echo $hello         : 변수 생성 출력   
     
     
### 도커 이미지      
  [개념] 도커이미지는 여러개의 레이어들로 되어 있다. 그중에서 베이스 이미지는 이 이미지의 기반이 되는 부분이다.   
  [생성]    
   1. 도커 파일 작성    
      도커 파일이란 도커 이미지를 만들기 위한 설정 파일. 컨테이너가 어떻게 행동해야 하는지에 대한 설정을 정의한다.   
   2. 도커 클라이언트      
      도커 파일에 입력된 명령들이 도커 클라이언트에 전달   
   3. 도커 서버   
      도커 클라이언트에 전달된 모든 중요한 작업을 실행   
   4. 이미지 생성   
      
  [명령어]   
   FROM : 이미지 생성 시 기반이 되는 이미지(베이스 이미지)   
   RUN : 도커 이미지가 생성되기 전 수행할 명령어   
   CMD : 컨테이너가 시작되었을 때 실행할 실해파일 또는 쉘 스크립트. 해당 명령어는 Dockerfile 내 1회만 실행할수 있다.   
      
   [도커 이미지 만들기]   
    도커 파일 -> 도커 틀라이언트 -> 도커 서버 -> 이미지   
    $ docker build ./    
    or    
    $ docker build .   
    도커 파일에 입력된 것들이 도커 클라이언트에 전달되어 도커 서버가 인식한다.    
    Build : 이 명령어는 해당 디렉토리 내에서 dockerfile 이라는 파일을 찾아서 도커 클리아언트에 전달 시켜준다.    
    docker build 뒤에 ./ 와 . 는 둘다 현재 디렉토리를 가리킨다.   
    해당 명령어를 실행하면 임시 컨테이너를 생성후 이 컨테이너를 토대로 새로운 이미지(이미지 아이디 다름)를 만든다. 그 후 임시 컨테이너는 삭제된다.    
    이미지 -> 임시컨테이너 [이미지아이디: abc123](새로운 명렁어, 새로운 파일 스냅숏 추가) => 새로운 이미지 [이미지 아이디: qwe456]   
    
